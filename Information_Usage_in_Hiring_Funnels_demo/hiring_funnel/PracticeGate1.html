{{ extends "global/Page.html" }}
{{ block title }}Practice Round - Gate 1: Resume Screening{{ endblock }}

{{ block content }}

<link rel="stylesheet" href="{{ static 'hiring-funnel.css' }}">

{{ if form_error }}
<div style="background-color: #ffcccc; border: 2px solid #ff0000; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
    <p style="color: #cc0000; font-weight: bold;">{{ form_error }}</p>
</div>
{{ endif }}

<form method="post">
    
<div class="table-scroll">
    <table class="candidate-scores-table">
        <thead>
            <tr>
                <th class="score-type-header" rowspan="2">Score Type</th>
                <th colspan="10" style="text-align: center; border-bottom: 1px solid #999; padding: 4px; font-weight: bold;">Candidates</th>
            </tr>
            <tr>
                {% for candidate in candidates %}
                    <th class="candidate-header">{{ candidate.label }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="row-label">Stage 1: Resume</td>
                {% for candidate in candidates %}
                    <td class="score-cell">{{ candidate.resume }}</td>
                {% endfor %}
            </tr>
            <tr class="checkbox-row">
                <td class="row-label">Select</td>
                {% for candidate in candidates %}
                    <td class="checkbox-cell">
                        {% if candidate.label in form_post_gate1_choices %}
                            <input type="checkbox" id="gate1-{{ candidate.label }}" name="gate1_checkbox" value="{{ candidate.label }}" data-candidate="{{ candidate.label }}" checked>
                        {% else %}
                            <input type="checkbox" id="gate1-{{ candidate.label }}" name="gate1_checkbox" value="{{ candidate.label }}" data-candidate="{{ candidate.label }}">
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
</div>

<div class="instruction-text" style="margin-top: 20px;">
    <p>Review the 10 candidates' Resume scores. Select exactly <strong>5 candidates</strong> to advance to the next stage (Gate 2: Zoom Interviews).</p>
</div>

<div class="gate-instruction" id="selection-counter">Selected: 0 / {{ required_count }}</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[name="gate1_checkbox"]');
    const required = {{ required_count }};
    const counter = document.getElementById('selection-counter');
    const hiddenInput = document.getElementById('gate1-choices-json');
    
    function updateCounter() {
        const selectedBoxes = document.querySelectorAll('input[name="gate1_checkbox"]:checked');
        const selected = selectedBoxes.length;
        const values = Array.from(selectedBoxes).map(cb => cb.value);
        counter.textContent = `Selected: ${selected} / ${required}`;
        counter.className = 'gate-instruction';
        if (selected < required) {
            counter.classList.add('warning');
        } else if (selected > required) {
            counter.classList.add('error');
        }
        hiddenInput.value = JSON.stringify(values);
    }
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateCounter);
    });
    updateCounter();
});
</script>

<input type="hidden" id="gate1-choices-json" name="gate1_choices" value="">

{{ next_button }}

</form>

{{ endblock }}
