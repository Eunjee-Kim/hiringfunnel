{{ extends "global/Page.html" }}
{{ block title }}Main Round {{ round_num }} - Gate 2: Zoom Interviews{{ endblock }}

{{ block content }}

<link rel="stylesheet" href="{{ static 'hiring-funnel.css' }}">

{{ if form_error }}
<div style="background-color: #ffcccc; border: 2px solid #ff0000; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
    <p style="color: #cc0000; font-weight: bold;">{{ form_error }}</p>
</div>
{{ endif }}

<form method="post">
    
<div class="table-scroll">
    <table class="candidate-scores-table">
        <thead>
            <tr>
                <th class="score-type-header" rowspan="2">Score Type</th>
                <th colspan="10" style="text-align: center; border-bottom: 1px solid #999; padding: 4px; font-weight: bold;">Candidates</th>
            </tr>
            <tr>
                {% for candidate in candidates %}
                    <th class="candidate-header{% if candidate.eliminated %} eliminated{% endif %}">{% if not candidate.eliminated %}{{ candidate.label }}{% endif %}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="row-label">Stage 1: Resume</td>
                {% for candidate in candidates %}
                    <td class="score-cell{% if candidate.eliminated %} eliminated{% endif %}">{% if not candidate.eliminated %}{{ candidate.resume }}{% endif %}</td>
                {% endfor %}
            </tr>
            <tr>
                <td class="row-label">Stage 2: Zoom</td>
                {% for candidate in candidates %}
                    <td class="score-cell{% if candidate.eliminated %} eliminated{% endif %}">{% if not candidate.eliminated %}{{ candidate.zoom }}{% endif %}</td>
                {% endfor %}
            </tr>
            <tr class="checkbox-row">
                <td class="row-label">Select</td>
                {% for candidate in candidates %}
                    <td class="checkbox-cell{% if candidate.eliminated %} eliminated{% endif %}">
                        {% if candidate.label in form_post_gate2_choices %}
                            <input type="checkbox" id="gate2-{{ candidate.label }}" name="gate2_checkbox" value="{{ candidate.label }}" {% if candidate.eliminated %}disabled{% endif %} checked>
                        {% else %}
                            <input type="checkbox" id="gate2-{{ candidate.label }}" name="gate2_checkbox" value="{{ candidate.label }}" {% if candidate.eliminated %}disabled{% endif %}>
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
</div>

<div class="instruction-text" style="margin-top: 20px;">
    <p>Now you can see Zoom scores. Select exactly <strong>{{ required_count }} candidates</strong> to advance to Gate 3.</p>
</div>

<div class="gate-instruction" id="selection-counter">Selected: 0 / {{ required_count }}</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[name="gate2_checkbox"]');
    const required = {{ required_count }};
    const counter = document.getElementById('selection-counter');
    const hiddenInput = document.getElementById('gate2-choices-json');
    
    function updateCounter() {
        const selectedBoxes = document.querySelectorAll('input[name="gate2_checkbox"]:checked');
        const selected = selectedBoxes.length;
        const values = Array.from(selectedBoxes).map(cb => cb.value);
        counter.textContent = `Selected: ${selected} / ${required}`;
        counter.className = 'gate-instruction';
        if (selected < required) counter.classList.add('warning');
        else if (selected > required) counter.classList.add('error');
        hiddenInput.value = JSON.stringify(values);
    }
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateCounter);
    });
    updateCounter();
});
</script>

<input type="hidden" id="gate2-choices-json" name="gate2_choices" value="">

{{ next_button }}

</form>

{{ endblock }}